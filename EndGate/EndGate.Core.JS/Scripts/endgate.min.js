var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},GameRunnerInstance,eg,EndGate;(function(){})(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(n){var t=function(){function n(){this._type="GameTime",this.Now=new Date,this._start=this.Now.getTime()}return n.prototype.Update=function(){var n=new Date,t=n.getTime();this.Elapsed=t-this.Now.getTime(),this.ElapsedSecond=this.Elapsed/1e3,this.Total=t-this._start,this.Now=n},n}();n.GameTime=t}(EndGate||(EndGate={})),function(n){var t=function(){function n(n,t){this._type="Size2d",this.Width=n||0,this.Height=typeof t!="undefined"?t:this.Width}return n.Zero=function(){return new n(0,0)},n.One=function(){return new n(1,1)},n.prototype.Radius=function(){return.5*Math.sqrt(this.Width*this.Width+this.Height*this.Height)},n.prototype.HalfWidth=function(){return this.Width/2},n.prototype.HalfHeight=function(){return this.Height/2},n.prototype.Apply=function(n){this.Width=n(this.Width),this.Height=n(this.Height)},n.prototype.Trigger=function(n){n(this.Width),n(this.Height)},n.prototype.Add=function(t){return t._type==="Size2d"?new n(this.Width+t.Width,this.Height+t.Height):t._type==="Vector2d"?new n(this.Width+t.X,this.Height+t.Y):new n(this.Width+t,this.Height+t)},n.prototype.Multiply=function(t){return t._type==="Size2d"?new n(this.Width*t.Width,this.Height*t.Height):t._type==="Vector2d"?new n(this.Width*t.X,this.Height*t.Y):new n(this.Width*t,this.Height*t)},n.prototype.Subtract=function(t){return t._type==="Size2d"?new n(this.Width-t.Width,this.Height-t.Height):t._type==="Vector2d"?new n(this.Width-t.X,this.Height-t.Y):new n(this.Width-t,this.Height-t)},n.prototype.SubtractFrom=function(t){return t._type==="Size2d"?new n(t.Width-this.Width,t.Height-this.Height):t._type==="Vector2d"?new n(t.X-this.Width,t.Y-this.Height):new n(t-this.Width,t-this.Height)},n.prototype.Divide=function(t){return t._type==="Size2d"?new n(this.Width/t.Width,this.Height/t.Height):t._type==="Vector2d"?new n(this.Width/t.X,this.Height/t.Y):new n(this.Width/t,this.Height/t)},n.prototype.DivideFrom=function(t){return t._type==="Size2d"?new n(t.Width/this.Width,t.Height/this.Height):t._type==="Vector2d"?new n(t.X/this.Width,t.Y/this.Height):new n(t/this.Width,t/this.Height)},n.prototype.Negate=function(){return new n(this.Width*-1,this.Height*-1)},n.prototype.Equivalent=function(n){return this.Width===n.Width&&this.Height===n.Height},n.prototype.Clone=function(){return new n(this.Width,this.Height)},n.prototype.toString=function(){return"("+this.Width+", "+this.Height+")"},n}();n.Size2d=t}(EndGate||(EndGate={})),Math.roundTo=function(n,t){var i=Math.pow(10,t);return Math.round(n*i)/i},Math.twoPI=Math.PI*2,function(n){var t=function(){function n(n,t){this._type="Vector2d",this.X=n||0,this.Y=t||0}return n.Zero=function(){return new n(0,0)},n.One=function(){return new n(1,1)},n.prototype.ProjectOnto=function(n){return n.Multiply(this.Dot(n)/n.Dot(n))},n.prototype.RotateAround=function(t,i,r){typeof r=="undefined"&&(r=2);var u=Math.cos(i),f=Math.sin(i);return new n(Math.roundTo(u*(this.X-t.X)-f*(this.Y-t.Y)+t.X,r),Math.roundTo(f*(this.X-t.X)+u*(this.Y-t.Y)+t.Y,r))},n.prototype.Apply=function(n){this.X=n(this.X),this.Y=n(this.Y)},n.prototype.Trigger=function(n){n(this.X),n(this.Y)},n.prototype.Normalized=function(){var t=this.Magnitude();return new n(this.X/t,this.Y/t)},n.prototype.Magnitude=function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},n.prototype.Length=function(){return this.Magnitude()},n.prototype.Dot=function(n){return n.X*this.X+n.Y*this.Y},n.prototype.Abs=function(){return new n(Math.abs(this.X),Math.abs(this.Y))},n.prototype.Sign=function(){return new n(this.X/Math.abs(this.X),this.Y/Math.abs(this.Y))},n.prototype.Distance=function(t){return new n(Math.abs(t.X-this.X),Math.abs(t.Y-this.Y))},n.prototype.Add=function(t){return t._type==="Vector2d"?new n(this.X+t.X,this.Y+t.Y):t._type==="Size2d"?new n(this.X+t.Width,this.Y+t.Height):new n(this.X+t,this.Y+t)},n.prototype.Multiply=function(t){return t._type==="Vector2d"?new n(this.X*t.X,this.Y*t.Y):t._type==="Size2d"?new n(this.X*t.Width,this.Y*t.Height):new n(this.X*t,this.Y*t)},n.prototype.Subtract=function(t){return t._type==="Vector2d"?new n(this.X-t.X,this.Y-t.Y):t._type==="Size2d"?new n(this.X-t.Width,this.Y-t.Height):new n(this.X-t,this.Y-t)},n.prototype.SubtractFrom=function(t){return t._type==="Vector2d"?new n(t.X-this.X,t.Y-this.Y):t._type==="Size2d"?new n(t.Width-this.X,t.Height=this.Y):new n(t-this.X,t-this.Y)},n.prototype.Divide=function(t){return t._type==="Vector2d"?new n(this.X/t.X,this.Y/t.Y):t._type==="Size2d"?new n(this.X/t.Width,this.Y/t.Height):new n(this.X/t,this.Y/t)},n.prototype.DivideFrom=function(t){return t._type==="Vector2d"?new n(t.X/this.X,t.Y/this.Y):t._type==="Size2d"?new n(t.Width/this.X,t.Height/this.Y):new n(t/this.X,t/this.Y)},n.prototype.IsZero=function(){return this.X===0&&this.Y===0},n.prototype.Negate=function(){return new n(this.X*-1,this.Y*-1)},n.prototype.Equivalent=function(n){return this.X===n.X&&this.Y===n.Y},n.prototype.Clone=function(){return new n(this.X,this.Y)},n.prototype.toString=function(){return"("+this.X+", "+this.Y+")"},n}();n.Vector2d=t}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(n){this._boundsType="Bounds2d",this.Position=n,this.Rotation=0}return n.prototype.Scale=function(){throw new Error("This method is abstract!");},n.prototype.ContainsPoint=function(){throw new Error("This method is abstract!");},n.prototype.Intersects=function(n){if(n._boundsType==="BoundingCircle")return this.IntersectsCircle(n);if(n._boundsType==="BoundingRectangle")return this.IntersectsRectangle(n);throw new Error("Cannot intersect with unidentifiable object, must be BoundingCircle or BoundingRectangle");},n.prototype.IntersectsCircle=function(){throw new Error("This method is abstract!");},n.prototype.IntersectsRectangle=function(){throw new Error("This method is abstract!");},n}();n.Bounds2d=t})(n.Abstractions||(n.Abstractions={}));var t=n.Abstractions})(n.Bounds||(n.Bounds={}));var t=n.Bounds}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(t){this._type="LooperCallback",this.Callback=t,this.ID=n._ids++}return n._ids=0,n}();n.LooperCallback=t})(n.Loopers||(n.Loopers={}));var t=n.Loopers})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(){})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(n){function t(t,i){n.call(this,i),this._type="TimedCallback",this.Fps=t,this.TimeoutID=0,this.Active=!1}return __extends(t,n),t}(n.LooperCallback);n.TimedCallback=t})(n.Loopers||(n.Loopers={}));var t=n.Loopers})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(){this._type="Looper",this._running=!1,this._callbacks=[]}return n.prototype.AddCallback=function(n){var t=this;this._callbacks.push(n),n.Active=!0,this._running&&window.setTimeout(function(){t.Loop(n)},0)},n.prototype.RemoveCallback=function(n){for(var t=0;t<this._callbacks.length;t++)if(this._callbacks[t].ID===n.ID){window.clearTimeout(n.TimeoutID),n.Active=!1,this._callbacks.splice(t,1);return}},n.prototype.Start=function(){this._running=!0,this.Run()},n.prototype.Run=function(){for(var t=this,n=0;n<this._callbacks.length;n++)window.setTimeout(function(n){return function(){t.Loop(t._callbacks[n])}}(n),0)},n.prototype.Loop=function(n){var t=this,i=1e3/n.Fps;n.Callback(),n.Active&&(n.TimeoutID=window.setTimeout(function(){t.Loop(n)},i))},n.prototype.Dispose=function(){for(var n=this._callbacks.length-1;n>=0;n--)this.RemoveCallback(this._callbacks[n]);this._callbacks=[],this._running=!1},n}();n.Looper=t})(n.Loopers||(n.Loopers={}));var t=n.Loopers})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),window.OnRepaintCompleted=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,0)}}(),function(n){(function(n){(function(n){var t=function(){function n(){this._type="RepaintLooper",this._running=!1,this._callbacksModified=!1,this._callbacks=[]}return n.prototype.Start=function(){this._running=!0,this.Run()},n.prototype.Run=function(){var t=this,n;if(this._running){for(this._callbacksModified=!1,n=0;n<this._callbacks.length;n++)if(this._callbacks[n].Callback(),this._callbacksModified)break;window.OnRepaintCompleted(function(){t.Run()})}},n.prototype.AddCallback=function(n){this._callbacksModified=!0,this._callbacks.push(n)},n.prototype.RemoveCallback=function(n){for(var t=0;t<this._callbacks.length;t++)if(this._callbacks[t].ID===n.ID){this._callbacksModified=!0,this._callbacks.splice(t,1);return}},n.prototype.Dispose=function(){this._callbacksModified=!0,this._callbacks=[],this._running=!1},n}();n.RepaintLooper=t})(n.Loopers||(n.Loopers={}));var t=n.Loopers})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(){this._type="GameRunner",this._updateCallbacks={},this._drawCallbacks={},this._updateLoop=null,this._drawLoop=null,this._callbackCount=0}return t.prototype.Register=function(n){var t=this.CreateAndCacheUpdateCallback(n),i=this.CreateAndCacheDrawCallback(n);return this._callbackCount++,this.TryLoopStart(),this._updateLoop.AddCallback(t),this._drawLoop.AddCallback(i),this.CreateUpdateRateSetter(t)},t.prototype.Unregister=function(n){var t,i;this._updateCallbacks[n.ID]&&(t=this._updateCallbacks[n.ID],i=this._drawCallbacks[n.ID],this._updateLoop.RemoveCallback(t),this._drawLoop.RemoveCallback(i),delete this._updateCallbacks[n.ID],delete this._drawCallbacks[n.ID],this._callbackCount--,this.TryLoopStop())},t.prototype.TryLoopStart=function(){this._callbackCount===1&&(this._updateLoop=new n.Loopers.Looper,this._updateLoop.Start(),this._drawLoop=new n.Loopers.RepaintLooper,this._drawLoop.Start())},t.prototype.TryLoopStop=function(){this._callbackCount===0&&this._updateLoop!=null&&(this._updateLoop.Dispose(),this._updateLoop=null,this._drawLoop.Dispose(),this._drawLoop=null)},t.prototype.CreateAndCacheUpdateCallback=function(t){var i=new n.Loopers.TimedCallback(0,function(){t.PrepareUpdate()});return this._updateCallbacks[t.ID]=i,i},t.prototype.CreateAndCacheDrawCallback=function(t){var i=new n.Loopers.LooperCallback(function(){t.PrepareDraw()});return this._drawCallbacks[t.ID]=i,i},t.prototype.CreateUpdateRateSetter=function(n){return function(t){n.Fps=t}},t}();n.GameRunner=t})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),GameRunnerInstance=new EndGate._.GameRunner,function(n){var t=function(){function n(n){this._defaultUpdateRate=40,this._updateRateSetter=n,this.UpdateRate(this._defaultUpdateRate)}return n.prototype.UpdateRate=function(n){if(typeof n!="undefined")this._updateRate=n,this._updateRateSetter(this._updateRate);else return this._updateRate},n}();n.GameConfiguration=t}(EndGate||(EndGate={})),function(n){var t=function(){function n(){this._type="Event",this._actions=[],this._hasBindings=!1}return n.prototype.Bind=function(n){this._actions.push(n),this._hasBindings=!0},n.prototype.Unbind=function(n){for(var t=0;t<this._actions.length;t++)if(this._actions[t]===n){this._actions.splice(t,1),this._hasBindings=this._actions.length>0;return}},n.prototype.HasBindings=function(){return this._hasBindings},n.prototype.Trigger=function(){for(var i=[],t,n=0;n<arguments.length-0;n++)i[n]=arguments[n+0];for(t=0;t<this._actions.length;t++)this._actions[t].apply(this,i)},n}();n.EventHandler=t}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(n,t){this.At=n,this.With=t}return n}();n.CollisionData=t})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Collision||(n.Collision={}));var t=n.Collision}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function t(i){this._type="Collidable",this._disposed=!1,this.Bounds=i,this.ID=t._collidableIDs++,this.OnCollision=new n.EventHandler,this.OnDisposed=new n.EventHandler}return t._collidableIDs=0,t.prototype.IsCollidingWith=function(n){return this.Bounds.Intersects(n.Bounds)},t.prototype.Collided=function(n){this.OnCollision.Trigger(n)},t.prototype.Dispose=function(){if(this._disposed)throw new Error("Cannot dispose collidable twice.");else this._disposed=!0,this.OnDisposed.Trigger(this)},t}();t.Collidable=i})(n.Collision||(n.Collision={}));var t=n.Collision}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function i(){this._type="CollisionManager",this._collidables=[],this._enabled=!1,this.OnCollision=new n.EventHandler}return i.prototype.Monitor=function(n){var t=this;this._enabled=!0,n.OnDisposed.Bind(function(){t.Unmonitor(n)}),this._collidables.push(n)},i.prototype.Unmonitor=function(n){for(var t=0;t<this._collidables.length;t++)if(this._collidables[t].ID===n.ID){this._collidables.splice(t,1);break}},i.prototype.Update=function(){var n,i,r,u;if(this._enabled)for(r=0;r<this._collidables.length;r++)for(n=this._collidables[r],u=r+1;u<this._collidables.length;u++)i=this._collidables[u],n.IsCollidingWith(i)&&(n.Collided(new t.Assets.CollisionData(n.Bounds.Position.Clone(),i)),i.Collided(new t.Assets.CollisionData(i.Bounds.Position.Clone(),n)),this.OnCollision.Trigger(n,i))},i}();t.CollisionManager=i})(n.Collision||(n.Collision={}));var t=n.Collision}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(){this._type="Graphic2dState",this._cachedState={}}return n.prototype.StrokeStyle=function(n){return this.GetOrSetCache("strokeStyle",n)},n.prototype.FillStyle=function(n){return this.GetOrSetCache("fillStyle",n)},n.prototype.GlobalAlpha=function(n){return this.GetOrSetCache("globalAlpha",n)},n.prototype.LineWidth=function(n){return this.GetOrSetCache("lineWidth",n)},n.prototype.LineCap=function(n){return this.GetOrSetCache("lineCap",n)},n.prototype.LineJoin=function(n){return this.GetOrSetCache("lineJoin",n)},n.prototype.MiterLimit=function(n){return this.GetOrSetCache("miterLimit",n)},n.prototype.ShadowOffsetX=function(n){return this.GetOrSetCache("shadowOffsetX",n)},n.prototype.ShadowOffsetY=function(n){return this.GetOrSetCache("shadowOffsetY",n)},n.prototype.ShadowBlur=function(n){return this.GetOrSetCache("shadowBlur",n)},n.prototype.ShadowColor=function(n){return this.GetOrSetCache("shadowColor",n)},n.prototype.GlobalCompositeOperation=function(n){return this.GetOrSetCache("globalCompositeOperation",n)},n.prototype.Font=function(n){return this.GetOrSetCache("font",n)},n.prototype.TextAlign=function(n){return this.GetOrSetCache("textAlign",n)},n.prototype.TextBaseline=function(n){return this.GetOrSetCache("textBaseline",n)},n.prototype.SetContextState=function(n){for(var t in this._cachedState)n[t]=this._cachedState[t]},n.prototype.GetOrSetCache=function(n,t){return typeof t!="undefined"&&(this._cachedState[n]=t),this._cachedState[n]},n}();n.Graphic2dState=t})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(t){var i=function(){function t(t){this._type="Graphic2d",this.Position=t,this.Rotation=0,this.ZIndex=0,this.State=new n.Assets.Graphic2dState,this._children=[]}return t._zindexSort=function(n,t){return n.ZIndex-t.ZIndex},t.prototype.AddChild=function(n){this._children.push(n),this._children.sort(t._zindexSort)},t.prototype.RemoveChild=function(n){var t=this._children.indexOf(n);return t>=0?(this._children.splice(t,1),!0):!1},t.prototype.Children=function(){return this._children},t.prototype.StartDraw=function(n){n.save(),this.State.SetContextState(n),n.translate(this.Position.X,this.Position.Y),this.Rotation!==0&&n.rotate(this.Rotation)},t.prototype.EndDraw=function(n){for(var t=0;t<this._children.length;t++)this._children[t].Draw(n);n.restore()},t.prototype.Draw=function(){},t.prototype.GetDrawBounds=function(){throw new Error("GetDrawBounds is abstract, it must be implemented.");},t}();t.Graphic2d=i})(n.Abstractions||(n.Abstractions={}));var t=n.Abstractions})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function n(n,t){this.Min=n,this.Max=t}return n}();n.MinMax=t})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(){}return t.GetMinMaxProjections=function(t,i){for(var u=i[0].ProjectOnto(t).Dot(t),e=u,o,r,f=1;f<i.length;f++)o=i[f],r=o.ProjectOnto(t).Dot(t),r<u?u=r:r>e&&(e=r);return new n.MinMax(u,e)},t}();n.Vector2dHelpers=t})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){var t=function(n){function t(t,i){n.call(this,t),this._type="BoundingCircle",this._boundsType="BoundingCircle",this.Radius=i}return __extends(t,n),t.prototype.Scale=function(n){this.Radius*=n},t.prototype.Area=function(){return Math.PI*this.Radius*this.Radius},t.prototype.Circumfrence=function(){return 2*Math.PI*this.Radius},t.prototype.IntersectsCircle=function(n){return this.Position.Distance(n.Position).Length()<this.Radius+n.Radius},t.prototype.IntersectsRectangle=function(n){var r=n.Rotation===0?this.Position:this.Position.RotateAround(n.Position,-n.Rotation),t=r.Distance(n.Position),i;return t.X>n.Size.HalfWidth()+this.Radius?!1:t.Y>n.Size.HalfHeight()+this.Radius?!1:t.X<=n.Size.HalfWidth()?!0:t.Y<=n.Size.HalfHeight()?!0:(i=Math.pow(t.X-n.Size.HalfWidth(),2)+Math.pow(t.Y-n.Size.HalfHeight(),2),i<=this.Radius*this.Radius)},t.prototype.ContainsPoint=function(n){return this.Position.Distance(n).Magnitude()<this.Radius},t}(n.Abstractions.Bounds2d);n.BoundingCircle=t})(n.Bounds||(n.Bounds={}));var t=n.Bounds}(EndGate||(EndGate={})),function(n){(function(t){var i=function(t){function i(n,i){t.call(this,n),this._type="BoundingRectangle",this._boundsType="BoundingRectangle",this.Size=i}return __extends(i,t),i.prototype.Scale=function(n){this.Size.Width*=n,this.Size.Height*=n},i.prototype.Vertices=function(){return[this.TopLeft(),this.TopRight(),this.BotLeft(),this.BotRight()]},i.prototype.TopLeft=function(){var t=new n.Vector2d(this.Position.X-this.Size.HalfWidth(),this.Position.Y-this.Size.HalfHeight());return this.Rotation===0?t:t.RotateAround(this.Position,this.Rotation)},i.prototype.TopRight=function(){var t=new n.Vector2d(this.Position.X+this.Size.HalfWidth(),this.Position.Y-this.Size.HalfHeight());return this.Rotation===0?t:t.RotateAround(this.Position,this.Rotation)},i.prototype.BotLeft=function(){var t=new n.Vector2d(this.Position.X-this.Size.HalfWidth(),this.Position.Y+this.Size.HalfHeight());return this.Rotation===0?t:t.RotateAround(this.Position,this.Rotation)},i.prototype.BotRight=function(){var t=new n.Vector2d(this.Position.X+this.Size.HalfWidth(),this.Position.Y+this.Size.HalfHeight());return this.Rotation===0?t:t.RotateAround(this.Position,this.Rotation)},i.prototype.IntersectsCircle=function(n){return n.IntersectsRectangle(this)},i.prototype.IntersectsRectangle=function(t){var i;if(this.Rotation===0&&t.Rotation===0){var r=this.TopLeft(),u=this.BotRight(),f=t.TopLeft(),e=t.BotRight();return f.X<=u.X&&e.X>=r.X&&f.Y<=u.Y&&e.Y>=r.Y}if(t.Position.Distance(this.Position).Magnitude()<=t.Size.Radius()+this.Size.Radius()){var o=[this.TopRight().Subtract(this.TopLeft()),this.TopRight().Subtract(this.BotRight()),t.TopLeft().Subtract(t.BotLeft()),t.TopLeft().Subtract(t.TopRight())],l=this.Vertices(),a=t.Vertices();for(i=0;i<o.length;i++){var s=o[i],h=n._.Vector2dHelpers.GetMinMaxProjections(s,l),c=n._.Vector2dHelpers.GetMinMaxProjections(s,a);if(c.Max<h.Min||h.Max<c.Min)return!1}return!0}return!1},i.prototype.ContainsPoint=function(n){var r=this.Rotation,t,i;return this.Rotation!==0&&(this.Rotation=0,n=n.RotateAround(this.Position,-r)),t=this.TopLeft(),i=this.BotRight(),this.Rotation=r,n.X<=i.X&&n.X>=t.X&&n.Y<=i.Y&&n.Y>=t.Y},i}(t.Abstractions.Bounds2d);t.BoundingRectangle=i})(n.Bounds||(n.Bounds={}));var t=n.Bounds}(EndGate||(EndGate={})),function(n){(function(t){var i=function(n){function t(i,r){n.call(this,i,r),this._type="Camera2d",this.Distance=t.DefaultDistance}return __extends(t,n),t.DefaultDistance=1e3,t.prototype.GetDistanceScale=function(){return this.Distance/t.DefaultDistance},t.prototype.ToCameraRelative=function(n){var t=this.Position.Subtract(this.Size.Multiply(this.GetDistanceScale()*.5));return t.Add(n.Multiply(this.GetDistanceScale()))},t.prototype.GetInverseDistanceScale=function(){return t.DefaultDistance/this.Distance},t}(n.Bounds.BoundingRectangle);t.Camera2d=i})(n.Rendering||(n.Rendering={}));var t=n.Rendering}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function t(t){this._visibleCanvas=t,this._visibleContext=t.getContext("2d"),this._bufferCanvas=document.createElement("canvas"),this._bufferContext=this._bufferCanvas.getContext("2d"),this.OnRendererSizeChange=new n.EventHandler,this.UpdateBufferSize(),this._disposed=!1}return t._zindexSort=function(n,t){return n.ZIndex-t.ZIndex},t.prototype.Render=function(n){(this._bufferCanvas.width!==this._visibleCanvas.width||this._bufferCanvas.height!==this._visibleCanvas.height)&&this.UpdateBufferSize(),this._visibleContext.clearRect(0,0,this._visibleCanvas.width,this._visibleCanvas.height),this._visibleContext.drawImage(this._bufferCanvas,0,0),this._ClearBuffer(),n.sort(t._zindexSort);for(var i=0;i<n.length;i++)n[i].Draw(this._bufferContext);return this._bufferContext},t.prototype.Dispose=function(){this._disposed||(this._disposed=!0,this._visibleCanvas.parentNode.removeChild(this._visibleCanvas))},t.prototype._ClearBuffer=function(){this._bufferContext.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height)},t.prototype.UpdateBufferSize=function(){this._bufferCanvas.width=this._visibleCanvas.width,this._bufferCanvas.height=this._visibleCanvas.height,this.OnRendererSizeChange.Trigger(new n.Size2d(this._visibleCanvas.width,this._visibleCanvas.height))},t}();t.Renderer2d=i})(n.Rendering||(n.Rendering={}));var t=n.Rendering}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(n){this._camera=n,this._canvasCenter=this._camera.Position.Clone(),this._translated=!1,this._translationState=[],this._translationState.push(this._translated)}return n.prototype.BuildFrom=function(n){var t=this,i=n.createRadialGradient,r=n.translate,u=n.save,f=n.restore,e=this.BuildPositionReplacer(n.drawImage,1),o=this.BuildPositionReplacer(n.drawImage,5);return n.unModifiedClearRect=n.clearRect,n.arc=this.BuildPositionReplacer(n.arc),n.arcTo=this.BuildPositionReplacer(n.arcTo,0,4),n.bezierCurveTo=this.BuildPositionReplacer(n.bezierCurveTo,0,6),n.clearRect=this.BuildPositionReplacer(n.clearRect),n.createLinearGradient=this.BuildPositionReplacer(n.createLinearGradient,0,4),n.createRadialGradient=function(){var n=t._camera.GetDistanceScale();return arguments[0]+=-t._camera.Position.X+t._canvasCenter.X*n,arguments[1]+=-t._camera.Position.Y+t._canvasCenter.Y*n,arguments[3]+=-t._camera.Position.X+t._canvasCenter.X*n,arguments[4]+=-t._camera.Position.Y+t._canvasCenter.Y*n,i.apply(this,arguments)},n.drawImage=function(){arguments.length<=5?e.apply(this,arguments):o.apply(this,arguments)},n.fillRect=this.BuildPositionReplacer(n.fillRect),n.fillText=this.BuildPositionReplacer(n.fillText,1),n.getImageData=this.BuildPositionReplacer(n.getImageData),n.isPointInPath=this.BuildPositionReplacer(n.isPointInPath),n.lineTo=this.BuildPositionReplacer(n.lineTo),n.moveTo=this.BuildPositionReplacer(n.moveTo),n.putImageData=this.BuildPositionReplacer(n.putImageData,1),n.quadraticCurveTo=this.BuildPositionReplacer(n.quadraticCurveTo,0,4),n.rect=this.BuildPositionReplacer(n.rect),n.strokeRect=this.BuildPositionReplacer(n.strokeRect),n.strokeText=this.BuildPositionReplacer(n.strokeText,1),n.save=function(){t._translationState.push(t._translated),u.call(this)},n.restore=function(){t._translated=t._translationState.pop(),f.call(this)},n.translate=function(){var n;t._translated||(n=t._camera.GetDistanceScale(),arguments[0]+=-t._camera.Position.X+t._canvasCenter.X*n,arguments[1]+=-t._camera.Position.Y+t._canvasCenter.Y*n),t._translated=!0,r.apply(this,arguments)},n},n.prototype.UpdateCanvasCenter=function(n){this._canvasCenter.X=n.Width/2,this._canvasCenter.Y=n.Height/2},n.prototype.BuildPositionReplacer=function(n,t,i){typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=2);var r=this,u=["X","Y"];return function(){var o,e,f;if(!r._translated)for(o=r._camera.GetDistanceScale(),f=0;f<i;f++)e=u[f%2],arguments[t+f]+=-r._camera.Position[e]+r._canvasCenter[e]*o;return n.apply(this,arguments)}},n}();n.Camera2dCanvasContextBuilder=t})(n._||(n._={}));var t=n._})(n.Rendering||(n.Rendering={}));var t=n.Rendering}(EndGate||(EndGate={})),function(n){(function(t){var i=function(i){function r(r,u){i.call(this,r),this._camera=u,this._contextBuilder=new t._.Camera2dCanvasContextBuilder(this._camera),this.OnRendererSizeChange.Bind(this._contextBuilder.UpdateCanvasCenter),this._contextBuilder.UpdateCanvasCenter(new n.Size2d(r.width,r.height)),this._bufferContext=this._contextBuilder.BuildFrom(this._bufferContext)}return __extends(r,i),r.prototype.Render=function(n){var t,r=this._camera.GetInverseDistanceScale();return this._bufferContext.save(),this._bufferContext.scale(r,r),t=i.prototype.Render.call(this,this.GetOnScreenRenderables(n)),this._bufferContext.restore(),t},r.prototype._ClearBuffer=function(){var n=this._camera.GetDistanceScale();this._bufferContext.unModifiedClearRect(0,0,this._bufferCanvas.width*n,this._bufferCanvas.height*n)},r.prototype.GetOnScreenRenderables=function(n){var r=[],i=this._camera.GetDistanceScale(),u=1/i,t;for(this._camera.Scale(i,i),t=0;t<n.length;t++)this._camera.Intersects(n[t].GetDrawBounds())&&r.push(n[t]);return this._camera.Scale(u,u),r},r}(t.Renderer2d);t.Camera2dRenderer=i})(n.Rendering||(n.Rendering={}));var t=n.Rendering}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function i(i,r){this._type="Scene",this._actors=[],typeof i=="undefined"&&(i=this.CreateDefaultDrawArea()),this._onDraw=typeof r=="undefined"?function(){}:r,this.ApplyStyles(i),this.DrawArea=i,this.Camera=new t.Camera2d(new n.Vector2d(this.DrawArea.width/2,this.DrawArea.height/2),new n.Size2d(this.DrawArea.width,this.DrawArea.height)),this._renderer=new t.Camera2dRenderer(this.DrawArea,this.Camera),this._disposed=!1}return i.prototype.Add=function(n){this._actors.push(n)},i.prototype.Remove=function(n){for(var t=0;t<this._actors.length;t++)if(this._actors[t]===n){this._actors.splice(t,1);return}},i.prototype.Draw=function(){this._onDraw(this._renderer.Render(this._actors))},i.prototype.Dispose=function(){this._disposed||(this._disposed=!0,this._actors=[],this._renderer.Dispose())},i.prototype.ApplyStyles=function(n){n.style.position="absolute",n.style.zIndex="2",n.parentElement.style.position="relative"},i.prototype.CreateDefaultDrawArea=function(){var n=document.createElement("canvas");return n.width=window.innerWidth,n.height=window.innerHeight,document.getElementsByTagName("body")[0].appendChild(n),n},i}();t.Scene2d=i})(n.Rendering||(n.Rendering={}));var t=n.Rendering}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function n(){}return n.Left="Left",n.Middle="Middle",n.Right="Right",n}();n.MouseButton=t})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function i(t){var i=this;this._target=t,this.OnClick=new n.EventHandler,this.OnDoubleClick=new n.EventHandler,this.OnDown=new n.EventHandler,this.OnUp=new n.EventHandler,this.OnMove=new n.EventHandler,this.OnScroll=new n.EventHandler,this.LeftIsDown=!1,this.MiddleIsDown=!1,this.RightIsDown=!1,this.Wire(),this.OnDown.Bind(function(n){i.IsDown=!0,i[n.Button+"IsDown"]=!0}),this.OnUp.Bind(function(n){i.IsDown=!1,i[n.Button+"IsDown"]=!1})}return i.MouseButtonArray=[null,t.MouseButton.Left,t.MouseButton.Middle,t.MouseButton.Right],i.prototype.Wire=function(){var n=this;this._target.addEventListener("click",this._target.oncontextmenu=this.BuildEvent(this.OnClick,this.BuildMouseClickEvent),!1),this._target.addEventListener("dblclick",this.BuildEvent(this.OnDoubleClick,this.BuildMouseClickEvent),!1),this._target.addEventListener("mousedown",this.BuildEvent(this.OnDown,this.BuildMouseClickEvent),!1),this._target.addEventListener("mouseup",this.BuildEvent(this.OnUp,this.BuildMouseClickEvent),!1),this._target.addEventListener("mousemove",this.BuildEvent(this.OnMove,this.BuildMouseEvent),!1),/MSIE/i.test(navigator.userAgent)?this._target.addEventListener("wheel",this.BuildEvent(this.OnScroll,function(t){return t.wheelDeltaX=-t.deltaX,t.wheelDeltaY=-t.deltaY,n.BuildMouseScrollEvent(t)}),!1):/Firefox/i.test(navigator.userAgent)?this._target.addEventListener("DOMMouseScroll",this.BuildEvent(this.OnScroll,function(t){return t.wheelDeltaX=t.axis===1?-t.detail:0,t.wheelDeltaY=t.axis===2?-t.detail:0,n.BuildMouseScrollEvent(t)}),!1):this._target.addEventListener("mousewheel",this.BuildEvent(this.OnScroll,this.BuildMouseScrollEvent),!1)},i.prototype.BuildEvent=function(n,t,i){typeof i=="undefined"&&(i=!1);var r=this;return function(u){return n.HasBindings()&&(n.Trigger(t.call(r,u)),u.preventDefault()),i}},i.prototype.BuildMouseScrollEvent=function(n){return{Position:this.GetMousePosition(n),Direction:this.GetMouseScrollDierction(n)}},i.prototype.BuildMouseEvent=function(n){return{Position:this.GetMousePosition(n)}},i.prototype.BuildMouseClickEvent=function(n){return{Position:this.GetMousePosition(n),Button:this.GetMouseButton(n)}},i.prototype.GetMousePosition=function(t){return new n.Vector2d(t.offsetX?t.offsetX:t.pageX-this._target.offsetLeft,t.offsetY?t.offsetY:t.pageY-this._target.offsetTop)},i.prototype.GetMouseButton=function(n){return n.which?i.MouseButtonArray[n.which]:t.MouseButton.Right},i.prototype.GetMouseScrollDierction=function(t){return new n.Vector2d(-Math.max(-1,Math.min(1,t.wheelDeltaX)),-Math.max(-1,Math.min(1,t.wheelDeltaY)))},i}();t.MouseHandler=i})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(t,i){typeof i=="undefined"&&(i=!1),this._invoker=n._noop,this._action=t,i&&this.Trip()}return n._noop=function(){},n.prototype.Invoke=function(){for(var t=[],n=0;n<arguments.length-0;n++)t[n]=arguments[n+0];this._invoker.apply(this,t)},n.prototype.InvokeOnce=function(){for(var t=[],n=0;n<arguments.length-0;n++)t[n]=arguments[n+0];this._invoker.apply(this,t),this.Reset()},n.prototype.Trip=function(){this._invoker=this._action},n.prototype.Reset=function(){this._invoker=n._noop},n}();n.NoopTripInvoker=t})(n.Utilities||(n.Utilities={}));var t=n.Utilities})(n._||(n._={}));var t=n._}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(n,t,i){this.Ctrl=n,this.Alt=t,this.Shift=i}return n.prototype.Equivalent=function(n){return this.Ctrl===n.Ctrl&&this.Alt===n.Alt&&this.Shift===n.Shift},n.BuildFromCommandString=function(t){var i=t.toLowerCase().indexOf("ctrl+")>=0?!0:!1,r=t.toLowerCase().indexOf("alt+")>=0?!0:!1,u=t.toLowerCase().indexOf("shift+")>=0?!0:!1;return new n(i,r,u)},n}();n.KeyboardModifiers=t})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(n){var t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},i={"27":"esc","27":"escape","9":"tab","32":"space","13":"return","13":"enter","8":"backspace","45":"insert","36":"home","46":"delete","35":"end","37":"left","38":"up","39":"right","40":"down","112":"f1","113":"f2","114":"f3","115":"f4","116":"f5","117":"f6","118":"f7","119":"f8","120":"f9","121":"f10","122":"f11","123":"f12"},r=function(){function r(r){var f,u;this.Modifiers=new n.Assets.KeyboardModifiers(r.ctrlKey,r.altKey,r.shiftKey),r.keyCode?f=r.keyCode:r.which&&(f=r.which),(u=i[f])||(u=String.fromCharCode(f).toLowerCase(),this.Modifiers.Shift&&t[u]&&(u=t[u])),this.Key=u}return r.prototype.Matches=function(n){return this.Key.toLowerCase()===n.Key.toLowerCase()&&n.Modifiers.Equivalent(this.Modifiers)},r}();n.KeyboardCommandEvent=r})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(){}return n.ParseKey=function(n){var t=n.split("+");return t.length>1?t[t.length-1]:t[0]},n}();n.KeyboardCommandHelper=t})(n._||(n._={}));var t=n._})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(t){(function(i){var r=function(){function i(i,r){var u=this;this.Action=r,this.Modifiers=t.Assets.KeyboardModifiers.BuildFromCommandString(i),this.Key=t._.KeyboardCommandHelper.ParseKey(i),this.OnDispose=new n.EventHandler,this._onDisposeInvoker=new n._.Utilities.NoopTripInvoker(function(){u.OnDispose.Trigger()},!0)}return i.prototype.Dispose=function(){this._onDisposeInvoker.InvokeOnce()},i}();i.KeyboardCommand=r})(t.Assets||(t.Assets={}));var i=t.Assets})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function i(){this._onPressCommands={},this._onDownCommands={},this._onUpCommands={},this.OnKeyPress=new n.EventHandler,this.OnKeyDown=new n.EventHandler,this.OnKeyUp=new n.EventHandler,this.Wire()}return i._keyboardCommandIds=0,i.prototype.OnCommandPress=function(n,t){return this.UpdateCache(n,t,this._onPressCommands)},i.prototype.OnCommandDown=function(n,t){return this.UpdateCache(n,t,this._onDownCommands)},i.prototype.OnCommandUp=function(n,t){return this.UpdateCache(n,t,this._onUpCommands)},i.prototype.UpdateCache=function(n,r,u){var f=new t.Assets.KeyboardCommand(n,r),e=i._keyboardCommandIds++;return f.OnDispose.Bind(function(){delete u[e]}),u[e]=f,f},i.prototype.Wire=function(){document.addEventListener("keypress",this.BuildKeyEvent(this._onPressCommands,this.OnKeyPress),!1),document.addEventListener("keydown",this.BuildKeyEvent(this._onDownCommands,this.OnKeyDown),!1),document.addEventListener("keyup",this.BuildKeyEvent(this._onUpCommands,this.OnKeyUp),!1)},i.prototype.FocusingTextArea=function(n){var t;return(n.target?t=n.target:n.srcElement&&(t=n.srcElement),t.nodeType===3&&(t=t.parentNode),t.tagName==="INPUT"||t.tagName==="TEXTAREA")?!0:!1},i.prototype.BuildKeyEvent=function(n,i){var r=this;return function(u){var f,o=!0,e;if(!r.FocusingTextArea(u)){f=new t.KeyboardCommandEvent(u),i.Trigger(f);for(e in n)f.Matches(n[e])&&(n[e].Action(),u.preventDefault(),o=!1);return o}}},i}();t.KeyboardHandler=i})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(t){this.Mouse=new n.MouseHandler(t),this.Keyboard=new n.KeyboardHandler}return t}();n.InputManager=t})(n.Input||(n.Input={}));var t=n.Input}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function n(n,t,i,r){typeof n=="undefined"&&(n=!1),typeof t=="undefined"&&(t=100),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r="auto"),this.Repeat=n,this.Volume=t,this.AutoPlay=i,this.Preload=r}return n.Default=new n,n}();n.AudioSettings=t})(n.Sound||(n.Sound={}));var t=n.Sound}(EndGate||(EndGate={})),function(n){(function(t){var i={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},r=function(){function r(i,r){typeof r=="undefined"&&(r=t.AudioSettings.Default),this._settings=r,this._audio=document.createElement("audio"),this.SetAudioSource(i),this.ApplySettings(),this.OnComplete=new n.EventHandler}return r.prototype.Volume=function(n){return typeof n!="undefined"&&(this._settings.Volume=n,this._audio.volume=Math.max(Math.min(n/100,1),0)),this._settings.Volume},r.prototype.IsPlaying=function(){return!this._audio.paused},r.prototype.Complete=function(){return this._audio.ended},r.prototype.Play=function(){var n=this;this._audio.readyState===0?this._audio.addEventListener("canplay",function(){n._audio.play()},!0):this._audio.play()},r.prototype.Pause=function(){this._audio.pause()},r.prototype.Seek=function(n){var t=this;this._audio.readyState===0?this._audio.addEventListener("canplay",function(){t._audio.currentTime=n},!0):this._audio.currentTime=n},r.prototype.Stop=function(){this.Seek(0),this._audio.pause()},r.prototype.SetAudioSource=function(n){var r,u,t;for(n instanceof Array||(n=[n]),t=0;t<n.length;t++)r=document.createElement("source"),r.src=n[t],u=i[n[t].split(".").pop()],typeof u!="undefined"&&(r.type=u),this._audio.appendChild(r)},r.prototype.ApplySettings=function(){var n=this;this._audio.loop=this._settings.Repeat,this._audio.autoplay=this._settings.AutoPlay,this._audio.preload=this._settings.Preload,this.Volume(this._settings.Volume),this._audio.addEventListener("ended",function(t){n.OnComplete.Trigger(t)},!0)},r}();t.AudioClip=r})(n.Sound||(n.Sound={}));var t=n.Sound}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(n){this._source=n}return t.prototype.Play=function(t){typeof t=="undefined"&&(t=n.AudioSettings.Default);var i=new n.AudioClip(this._source,t);return i.Play(),i},t}();n.AudioPlayer=t})(n.Sound||(n.Sound={}));var t=n.Sound}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(){this._audioPlayers={}}return t.prototype.Load=function(t,i){return this._audioPlayers[t]=new n.AudioPlayer(i),this._audioPlayers[t]},t.prototype.Unload=function(n){var t=this._audioPlayers[n];return delete this._audioPlayers[n],t},t.prototype.Play=function(t,i){return typeof i=="undefined"&&(i=n.AudioSettings.Default),this._audioPlayers[t].Play(i)},t.prototype.GetPlayer=function(n){return this._audioPlayers[n]},t}();n.AudioManager=t})(n.Sound||(n.Sound={}));var t=n.Sound}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function t(t,i){this._camera=i,this._layers=[],this._sceneryCanvas=this.BuildSceneryCanvas(t),this._renderer=new n.Rendering.Camera2dRenderer(this._sceneryCanvas,this._camera)}return t.prototype.AddLayer=function(n){this._layers.push(n)},t.prototype.RemoveLayer=function(n){this._layers.splice(this._layers.indexOf(n),1)},t.prototype.Draw=function(){this._layers.sort(n.Graphics.Abstractions.Graphic2d._zindexSort),this._renderer.Render(this._layers)},t.prototype.BuildSceneryCanvas=function(n){var t=document.createElement("canvas"),i=n;return t.width=n.width,t.height=n.height,t.style.position="absolute",t.style.zIndex="1",n.parentElement.insertBefore(t,n),t},t}();t.SceneryHandler=i})(n.Map||(n.Map={}));var t=n.Map}(EndGate||(EndGate={})),function(n){(function(n){var t=function(){function t(t,i){this.Scenery=new n.SceneryHandler(t,i)}return t}();n.MapManager=t})(n.Map||(n.Map={}));var t=n.Map}(EndGate||(EndGate={})),function(n){var t=function(){function t(i){var r=this;this._type="Game",this._gameTime=new n.GameTime,this.ID=t._gameIds++,this.Scene=new n.Rendering.Scene2d(i,function(n){r.Draw(n)}),this.Input=new n.Input.InputManager(this.Scene.DrawArea),this.Audio=new n.Sound.AudioManager,this.CollisionManager=new n.Collision.CollisionManager,this.Configuration=new n.GameConfiguration(GameRunnerInstance.Register(this)),this.Map=new n.Map.MapManager(this.Scene.DrawArea,this.Scene.Camera)}return t._gameIds=0,t.prototype.PrepareUpdate=function(){this._gameTime.Update(),this.CollisionManager.Update(this._gameTime),this.Update(this._gameTime)},t.prototype.Update=function(){},t.prototype.PrepareDraw=function(){this.Map.Scenery.Draw(),this.Scene.Draw()},t.prototype.Draw=function(){},t.prototype.Dispose=function(){this.Scene.Dispose(),GameRunnerInstance.Unregister(this)},t}();n.Game=t}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function n(){this.Left=!1,this.Right=!1,this.Up=!1,this.Down=!1}return n}();n.LinearDirections=t})(n.Assets||(n.Assets={}));var t=n.Assets})(n.MovementControllers||(n.MovementControllers={}));var t=n.MovementControllers}(EndGate||(EndGate={})),function(){}(EndGate||(EndGate={})),function(n){(function(t){(function(t){var i=function(){function t(t){this.Position=n.Vector2d.Zero(),this.Velocity=n.Vector2d.Zero(),this.Rotation=0,this._frozen=!1,this._moveables=t}return t.prototype.Freeze=function(){this._frozen=!0},t.prototype.Thaw=function(){this._frozen=!1},t.prototype.IsMoving=function(){return!this._frozen&&!this.Velocity.IsZero()},t.prototype.Update=function(){for(var n=0;n<this._moveables.length;n++)this._moveables[n].Position=this.Position,this._moveables[n].Rotation=this.Rotation},t}();t.MovementController=i})(t.Abstractions||(t.Abstractions={}));var i=t.Abstractions})(n.MovementControllers||(n.MovementControllers={}));var t=n.MovementControllers}(EndGate||(EndGate={})),function(n){(function(t){var i=function(i){function r(r,u,f,e){typeof f=="undefined"&&(f=!0),typeof e=="undefined"&&(e=!0);var o=this;i.call(this,r),this._moveSpeed=u,this._moving=new t.Assets.LinearDirections,this.OnMove=new n.EventHandler,this._rotationUpdater=new n._.Utilities.NoopTripInvoker(function(){o.UpdateRotation()},f),this._velocityUpdater=e?this.UpdateVelocityWithMultiDirection:this.UpdateVelocityNoMultiDirection}return __extends(r,i),r.prototype.IsMovingInDirection=function(n){return this._moving[n]||!1},r.prototype.StartMoving=function(n){this.Move(n,!0)},r.prototype.StopMoving=function(n){this.Move(n,!1)},r.prototype.MoveSpeed=function(n){return typeof n!="undefined"&&(this._moveSpeed=n,this._velocityUpdater()),this._moveSpeed},r.prototype.Update=function(n){this._frozen||(this.Position=this.Position.Add(this.Velocity.Multiply(n.ElapsedSecond)),i.prototype.Update.call(this,n))},r.prototype.Move=function(n,t){if(typeof this._moving[n]!="undefined")this._moving[n]=t,this._velocityUpdater(),this._rotationUpdater.Invoke(),this.OnMove.Trigger({Direction:n,StartMoving:t});else throw new Error(n+" is an unknown direction.");},r.prototype.UpdateVelocityNoMultiDirection=function(){var t=n.Vector2d.Zero();t.IsZero()&&(this._moving.Up&&(t.Y-=this._moveSpeed),this._moving.Down&&(t.Y+=this._moveSpeed),t.Y===0&&(this._moving.Left&&(t.X-=this._moveSpeed),this._moving.Right&&(t.X+=this._moveSpeed))),this.Velocity=t},r.prototype.UpdateVelocityWithMultiDirection=function(){var t=n.Vector2d.Zero();this._moving.Up&&(t.Y-=this._moveSpeed),this._moving.Down&&(t.Y+=this._moveSpeed),this._moving.Left&&(t.X-=this._moveSpeed),this._moving.Right&&(t.X+=this._moveSpeed),this.Velocity=t},r.prototype.UpdateRotation=function(){this.Velocity.IsZero()||(this.Rotation=Math.atan2(this.Velocity.Y,this.Velocity.X))},r}(t.Abstractions.MovementController);t.LinearMovementController=i})(n.MovementControllers||(n.MovementControllers={}));var t=n.MovementControllers}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function t(t,i,r,u,f,e){typeof r=="undefined"&&(r=["w","Up"]),typeof u=="undefined"&&(u=["d","Right"]),typeof f=="undefined"&&(f=["s","Down"]),typeof e=="undefined"&&(e=["a","Left"]),this._keyboard=t,this._onMove=i,this._directions=new n.MovementControllers.Assets.LinearDirections,this.BindKeys(r,"OnCommandDown","Up",!0),this.BindKeys(u,"OnCommandDown","Right",!0),this.BindKeys(f,"OnCommandDown","Down",!0),this.BindKeys(e,"OnCommandDown","Left",!0),this.BindKeys(r,"OnCommandUp","Up",!1),this.BindKeys(u,"OnCommandUp","Right",!1),this.BindKeys(f,"OnCommandUp","Down",!1),this.BindKeys(e,"OnCommandUp","Left",!1)}return t.prototype.BindKeys=function(n,t,i,r){for(var f=this,u=0;u<n.length;u++)this._keyboard[t](n[u],function(){f._directions[i]!=r&&(f._directions[i]=r,f._onMove(i,r))})},t}();t.DirectionalInputController=i})(n.InputControllers||(n.InputControllers={}));var t=n.InputControllers}(EndGate||(EndGate={})),function(n){(function(n){(function(n){(function(n){n._map=[],n._map[0]="Ems",n.Ems=0,n._map[1]="Pixels",n.Pixels=1,n._map[2]="Points",n.Points=2,n._map[3]="Percent",n.Percent=3})(n.FontMeasurement||(n.FontMeasurement={}));var i=n.FontMeasurement,t=function(){function n(){}return n._Initialize=function(){n._measurements=["em","px","pt","%"]},n.Get=function(t){return n._measurements[t]},n}();n.FontMeasurementHelper=t,t._Initialize()})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(n){(function(n){n._map=[],n._map[0]="Antiqua",n.Antiqua=0,n._map[1]="Arial",n.Arial=1,n._map[2]="Avqest",n.Avqest=2,n._map[3]="Blackletter",n.Blackletter=3,n._map[4]="Calibri",n.Calibri=4,n._map[5]="ComicSans",n.ComicSans=5,n._map[6]="Courier",n.Courier=6,n._map[7]="Decorative",n.Decorative=7,n._map[8]="Fraktur",n.Fraktur=8,n._map[9]="Frosty",n.Frosty=9,n._map[10]="Garamond",n.Garamond=10,n._map[11]="Georgia",n.Georgia=11,n._map[12]="Helvetica",n.Helvetica=12,n._map[13]="Impact",n.Impact=13,n._map[14]="Minion",n.Minion=14,n._map[15]="Modern",n.Modern=15,n._map[16]="Monospace",n.Monospace=16,n._map[17]="Palatino",n.Palatino=17,n._map[18]="Roman",n.Roman=18,n._map[19]="Script",n.Script=19,n._map[20]="Swiss",n.Swiss=20,n._map[21]="TimesNewRoman",n.TimesNewRoman=21,n._map[22]="Verdana",n.Verdana=22})(n.FontFamily||(n.FontFamily={}));var t=n.FontFamily,i=function(){function n(){}return n._Initialize=function(){n._families={};for(var i in t)i!=="_map"&&(n._families[t[i]]=i);n._families[t.TimesNewRoman]="Times New Roman"},n.Get=function(t){return n._families[t]},n}();n.FontFamilyHelper=i,i._Initialize()})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(n){(function(n){n._map=[],n._map[0]="Normal",n.Normal=0,n._map[1]="SmallCaps",n.SmallCaps=1})(n.FontVariant||(n.FontVariant={}));var t=n.FontVariant,i=function(){function n(){}return n._Initialize=function(){n._variants={};for(var i in t)i!=="_map"&&(n._variants[t[i]]=i);n._variants.SmallCaps="Times New Roman"},n.Get=function(t){return n._variants[t]},n}();n.FontVariantHelper=i,i._Initialize()})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(n){(function(n){n._map=[],n._map[0]="Normal",n.Normal=0,n._map[1]="Italic",n.Italic=1,n._map[2]="Oblique",n.Oblique=2})(n.FontStyle||(n.FontStyle={}));var t=n.FontStyle,i=function(){function n(){}return n._Initialize=function(){n._styles={};for(var i in t)i!=="_map"&&(n._styles[t[i]]=i)},n.Get=function(t){return n._styles[t]},n}();n.FontStyleHelper=i,i._Initialize()})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(){function t(){this._cachedState={fontSize:"10px",fontFamily:"Times New Roman",fontVariant:"",fontWeight:"",fontStyle:""},this._refreshCache=!0,this._BuildFont()}return t.prototype.FontSize=function(t,i){return(typeof i=="undefined"&&(i=n.FontMeasurement.Points),t!==undefined)?this.GetOrSetCache("fontSize",t.toString()+n.FontMeasurementHelper.Get(i)):this._cachedState.fontSize},t.prototype.FontFamily=function(t){return this.GetOrSetCache("fontFamily",n.FontFamilyHelper.Get(t))},t.prototype.FontVariant=function(t){return this.GetOrSetCache("fontVariant",n.FontVariantHelper.Get(t))},t.prototype.FontWeight=function(n){return this.GetOrSetCache("fontWeight",n)},t.prototype.FontStyle=function(t){return this.GetOrSetCache("fontStyle",n.FontStyleHelper.Get(t))},t.prototype._BuildFont=function(){var n;return this._refreshCache&&(n=this._cachedState.fontWeight+" "+this._cachedState.fontStyle+" "+this._cachedState.fontSize+" "+this._cachedState.fontVariant,this._cachedState.fontFamily?(n+=this._cachedState.fontFamily,this._cachedState.fontFamilyType&&(n+=", "+this._cachedState.fontFamilyType)):this._cachedState.fontFamilyType&&(n+=this._cachedState.fontFamilyType),this._cachedFont=n.replace(/^\s\s*/,"").replace(/\s\s*$/,""),this._refreshCache=!1),this._cachedFont},t.prototype.GetOrSetCache=function(n,t){return typeof t!="undefined"&&(this._cachedState[n]=t,this._refreshCache=!0),this._cachedState[n]},t}();n.FontSettings=t})(n.Assets||(n.Assets={}));var t=n.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(i){function r(r,u,f,e){typeof e=="undefined"&&(e="black");var o=this;i.call(this,new n.Vector2d(r,u)),this._type="Text2d",this._text=f,this._stroker=new n._.Utilities.NoopTripInvoker(function(n){n.strokeText(o._text,0,0)}),this._drawBounds=new n.Bounds.BoundingRectangle(this.Position,n.Size2d.One()),this.FontSettings=new t.Assets.FontSettings,this.Align("center"),this.Baseline("middle"),this.Color(e)}return __extends(r,i),r.prototype.Align=function(n){return this.State.TextAlign(n)},r.prototype.Baseline=function(n){return this.State.TextBaseline(n)},r.prototype.Color=function(n){return this.State.FillStyle(n)},r.prototype.Shadow=function(n,t,i,r){return[this.ShadowX(n),this.ShadowY(t),this.ShadowColor(i),this.ShadowBlur(r)]},r.prototype.ShadowColor=function(n){return this.State.ShadowColor(n)},r.prototype.ShadowX=function(n){return this.State.ShadowOffsetX(n)},r.prototype.ShadowY=function(n){return this.State.ShadowOffsetY(n)},r.prototype.ShadowBlur=function(n){return this.State.ShadowBlur(n)},r.prototype.Opacity=function(n){return this.State.GlobalAlpha(n)},r.prototype.Text=function(n){return typeof n!="undefined"&&(this._text=n),this._text},r.prototype.Border=function(n,t){return[this.BorderThickness(n),this.BorderColor(t)]},r.prototype.BorderThickness=function(n){return n===0?this._stroker.Reset():this._stroker.Trip(),this.State.LineWidth(n)},r.prototype.BorderColor=function(n){return this._stroker.Trip(),this.State.StrokeStyle(n)},r.prototype.Draw=function(n){var t;i.prototype.StartDraw.call(this,n),this.State.Font(this.FontSettings._BuildFont()),t=n.measureText(this._text),this._drawBounds.Size.Width=t.width,this._drawBounds.Size.Height=parseInt(this.FontSettings.FontSize())*1.5,n.fillText(this._text,0,0),this._stroker.Invoke(n),i.prototype.EndDraw.call(this,n)},r.prototype.GetDrawBounds=function(){return this._drawBounds.Rotation=this.Rotation,this._drawBounds.Position=this.Position,this._drawBounds},r}(t.Abstractions.Graphic2d);t.Text2d=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){(function(t){var i=function(){function t(t,i,r,u,f,e,o){typeof u=="undefined"&&(u=0),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=i),typeof o=="undefined"&&(o=r);var s=this,h=typeof i!="undefined";this.Loaded=!1,this.OnLoaded=new n.EventHandler,this.Source=new Image,this.Source.onload=function(){s.Loaded=!0,h||(s.Size=new n.Size2d(s.Source.width,s.Source.height),s.ClipLocation=n.Vector2d.Zero(),s.ClipSize=s.Size.Clone()),s.OnLoaded.Trigger(s)},this.Source.src=t,this._imageLocation=t,h&&(this.Size=new n.Size2d(i,r),this.ClipLocation=new n.Vector2d(u,f),this.ClipSize=new n.Size2d(e,o))}return t.prototype.Extract=function(n,i,r,u){return new t(this._imageLocation,this.Size.Width,this.Size.Height,n,i,r,u)},t}();t.ImageSource=i})(t.Assets||(t.Assets={}));var i=t.Assets})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(t){function i(i,r,u,f,e){typeof f=="undefined"&&(f=u.ClipSize.Width),typeof e=="undefined"&&(e=u.ClipSize.Height),t.call(this,new n.Vector2d(i,r)),this._type="Sprite2d",this.Image=u,this.Size=new n.Size2d(f,e)}return __extends(i,t),i.prototype.Opacity=function(n){return this.State.GlobalAlpha(n)},i.prototype.Draw=function(n){t.prototype.StartDraw.call(this,n),n.drawImage(this.Image.Source,this.Image.ClipLocation.X,this.Image.ClipLocation.Y,this.Image.ClipSize.Width,this.Image.ClipSize.Height,-this.Size.HalfWidth(),-this.Size.HalfHeight(),this.Size.Width,this.Size.Height),t.prototype.EndDraw.call(this,n)},i.prototype.GetDrawBounds=function(){var t=new n.Bounds.BoundingRectangle(this.Position,this.Size);return t.Rotation=this.Rotation,t},i}(t.Abstractions.Graphic2d);t.Sprite2d=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(){function t(t,i,r,u,f){typeof f=="undefined"&&(f=n.Vector2d.Zero()),this._imageSource=t,this._frameSize=r,this._frameCount=u,this._startOffset=f,this._playing=!1,this._repeating=!1,this._currentFrame=0,this._framesPerRow=Math.min(Math.floor((t.ClipSize.Width-f.X)/r.Width),u),this._lastStepAt=0,this.OnComplete=new n.EventHandler,this.Fps(i)}return t.prototype.IsPlaying=function(){return this._playing},t.prototype.Play=function(n){typeof n=="undefined"&&(n=!1),this._lastStepAt=(new Date).getTime(),this._repeating=n,this._playing=!0,this.UpdateImageSource()},t.prototype.Pause=function(){this._playing=!1},t.prototype.Step=function(n){typeof n=="undefined"&&(n=1),this._currentFrame+=n,this._currentFrame>=this._frameCount&&(this._repeating?this._currentFrame%=this._frameCount:(this._currentFrame=this._frameCount-1,this.OnComplete.Trigger(),this.Stop(!1))),n!==0&&this.UpdateImageSource()},t.prototype.Stop=function(n){typeof n=="undefined"&&(n=!0),this._playing=!1,n&&this.Reset()},t.prototype.Reset=function(){this._currentFrame=0,this.UpdateImageSource()},t.prototype.Fps=function(n){return typeof n!="undefined"&&(this._fps=n,this._stepEvery=1e3/this._fps),this._fps},t.prototype.Update=function(n){var i=n.Now.getTime()-this._lastStepAt,t=0;this._playing&&(t=Math.floor(i/this._stepEvery),t!==0&&(this._lastStepAt=n.Now.getTime(),this.Step(t)))},t.prototype.UpdateImageSource=function(){var n=this.GetFrameRow(),t=this.GetFrameColumn();this._imageSource.ClipLocation.X=this._startOffset.X+t*this._frameSize.Width,this._imageSource.ClipLocation.Y=this._startOffset.Y+n*this._frameSize.Height,this._imageSource.ClipSize=this._frameSize},t.prototype.GetFrameRow=function(){return Math.floor(this._currentFrame/this._framesPerRow)},t.prototype.GetFrameColumn=function(){return Math.ceil(this._currentFrame%this._framesPerRow)},t}();t.SpriteAnimation=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(n){(function(n){var t=function(n){function t(t,i){n.call(this,t),this._type="Shape",this._fill=!1,this._stroke=!1,typeof i!="undefined"&&this.Color(i)}return __extends(t,n),t.prototype.Color=function(n){return this._fill=!0,this.State.FillStyle(n)},t.prototype.Border=function(n,t){return[this.BorderThickness(n),this.BorderColor(t)]},t.prototype.BorderThickness=function(n){return this.State.LineWidth(n)},t.prototype.BorderColor=function(n){return this._stroke=!0,this.State.StrokeStyle(n)},t.prototype.Shadow=function(n,t,i,r){return[this.ShadowX(n),this.ShadowY(t),this.ShadowColor(i),this.ShadowBlur(r)]},t.prototype.ShadowColor=function(n){return this._fill=!0,this.State.ShadowColor(n)},t.prototype.ShadowX=function(n){return this.State.ShadowOffsetX(n)},t.prototype.ShadowY=function(n){return this.State.ShadowOffsetY(n)},t.prototype.ShadowBlur=function(n){return this.State.ShadowBlur(n)},t.prototype.Opacity=function(n){return this.State.GlobalAlpha(n)},t.prototype.StartDraw=function(t){t.beginPath(),n.prototype.StartDraw.call(this,t)},t.prototype.EndDraw=function(t){this._fill&&t.fill(),this._stroke?t.stroke():t.closePath(),n.prototype.EndDraw.call(this,t)},t.prototype.BuildPath=function(){},t.prototype.Draw=function(n){this.StartDraw(n),this.BuildPath(n),this.EndDraw(n)},t}(n.Graphic2d);n.Shape=t})(n.Abstractions||(n.Abstractions={}));var t=n.Abstractions})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(t){function i(i,r,u,f){t.call(this,new n.Vector2d(i,r),f),this._type="Circle",this.Radius=u}return __extends(i,t),i.prototype.BuildPath=function(n){n.arc(0,0,this.Radius,0,Math.twoPI)},i.prototype.GetDrawBounds=function(){var t=new n.Bounds.BoundingCircle(this.Position,this.Radius);return t.Rotation=this.Rotation,t},i}(t.Abstractions.Shape);t.Circle=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(t){function i(i,r,u,f,e){t.call(this,new n.Vector2d(i,r),e),this._type="Rectangle",this.Size=new n.Size2d(u,f)}return __extends(i,t),i.prototype.BuildPath=function(n){n.rect(-this.Size.HalfWidth(),-this.Size.HalfHeight(),this.Size.Width,this.Size.Height)},i.prototype.GetDrawBounds=function(){var t=new n.Bounds.BoundingRectangle(this.Position,this.Size);return t.Rotation=this.Rotation,t},i}(t.Abstractions.Shape);t.Rectangle=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),eg=EndGate,function(n){(function(t){var i=function(t){function i(i,r,u,f,e,o){typeof e=="undefined"&&(e=1),t.call(this,n.Vector2d.Zero()),this._type="Line2d",this._from=new n.Vector2d(i,r),this._to=new n.Vector2d(u,f),this.LineWidth(e),this.UpdatePosition(),typeof o!="undefined"&&this.Color(o)}return __extends(i,t),i.prototype.From=function(n){return this.GetOrSetLinePoint("from",n)},i.prototype.To=function(n){return this.GetOrSetLinePoint("to",n)},i.prototype.Color=function(n){return this.State.StrokeStyle(n)},i.prototype.LineWidth=function(n){return this.State.LineWidth(n)},i.prototype.LineCap=function(n){return this.State.LineCap(n)},i.prototype.Draw=function(n){t.prototype.StartDraw.call(this,n),this._cachedPosition.Equivalent(this.Position)||this.RefreshCache(),n.beginPath(),n.moveTo(this._from.X-this.Position.X,this._from.Y-this.Position.Y),n.lineTo(this._to.X-this.Position.X,this._to.Y-this.Position.Y),n.stroke(),t.prototype.EndDraw.call(this,n)},i.prototype.GetDrawBounds=function(){var t=new n.Bounds.BoundingRectangle(this.Position,new n.Size2d(this._boundsWidth,this.LineWidth()));return t.Rotation=Math.atan2(this._difference.Y,this._difference.X)+this.Rotation,t},i.prototype.UpdatePosition=function(){this.Position=this._from.Add(this._to).Divide(2),this._difference=this._to.Subtract(this._from),this._boundsWidth=this._from.Distance(this._to).Length(),this._cachedPosition=this.Position.Clone()},i.prototype.RefreshCache=function(){var n=this.Position.Subtract(this._cachedPosition);this._from.X+=n.X,this._from.Y+=n.Y,this._to.X+=n.X,this._to.Y+=n.Y,this._cachedPosition=this.Position.Clone()},i.prototype.GetOrSetLinePoint=function(n,t){return typeof t=="undefined"&&(this["_"+n]=t,this.UpdatePosition()),this["_"+n]},i}(t.Abstractions.Graphic2d);t.Line2d=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(i){function r(r,u,f,e,o,s,h,c){var y,l,a,v,p;for(typeof h=="undefined"&&(h=!1),typeof c=="undefined"&&(c="gray"),i.call(this,new n.Vector2d(r,u)),this._type="Grid",this._size=new n.Size2d(o*e,s*f),this._tileSize=new n.Size2d(o,s),this._grid=[],this._rows=f,this._columns=e,this._drawGridLines=h,this._gridLines=[],y=this._size.Multiply(.5),l=new n.Vector2d(-y.Width,-y.Height),a=new n.Vector2d(y.Width,y.Height),v=0;v<f;v++)for(this._grid[v]=[],this._gridLines.push(new t.Line2d(l.X,l.Y+v*this._tileSize.Height,a.X,l.Y+v*this._tileSize.Height,1)),p=0;p<e;p++)v===0&&this._gridLines.push(new t.Line2d(l.X+p*this._tileSize.Width,l.Y,l.X+p*this._tileSize.Width,a.Y,1)),this._grid[v].push(null);this._gridLines.push(new t.Line2d(l.X,a.Y,a.X,a.Y,1)),this._gridLines.push(new t.Line2d(a.X,l.Y,a.X,a.Y,1)),this.Color(c)}return __extends(r,i),r.prototype.Color=function(n){if(typeof n!="undefined"){this._gridLineColor=n;for(var t=0;t<this._gridLines.length;t++)this._gridLines[t].Color(n)}return this._gridLineColor},r.prototype.Size=function(){return this._size.Clone()},r.prototype.TileSize=function(){return this._tileSize.Clone()},r.prototype.Rows=function(){return this._rows},r.prototype.Columns=function(){return this._columns},r.prototype.Opacity=function(n){return this.State.GlobalAlpha(n)},r.prototype.Fill=function(n,t,i){this.ValidRow(n)&&this.ValidColumn(t)&&(i.Position=this.GetInsideGridPosition(n,t),this._grid[n][t]=i,this.AddChild(i))},r.prototype.FillSpace=function(n,t,i){for(var f,u,r=0;r<i.length;r++)for(u=0;u<i[r].length;u++)f=i[r][u],f&&(f.Position=this.GetInsideGridPosition(r+n,u+t),this._grid[r+n][u+t]=f,this.AddChild(f))},r.prototype.FillRow=function(n,t,i){var u,r;for(typeof i=="undefined"&&(i=0),r=0;r<t.length;r++)u=t[r],u.Position=this.GetInsideGridPosition(n,r+i),this._grid[n][r+i]=u,this.AddChild(u)},r.prototype.FillColumn=function(n,t,i){var u,r;for(typeof i=="undefined"&&(i=0),r=0;r<t.length;r++)u=t[r],u.Position=this.GetInsideGridPosition(r+i,n),this._grid[r+i][n]=u,this.AddChild(u)},r.prototype.Get=function(n,t){return!this.ValidRow(n)||!this.ValidColumn(t)?null:this._grid[n][t]},r.prototype.GetColumn=function(n){for(var i=[],t=0;t<this._rows;t++)i.push(this._grid[t][n]);return i},r.prototype.GetRow=function(n){for(var i=[],t=0;t<this._columns;t++)i.push(this._grid[n][t]);return i},r.prototype.GetSpace=function(n,t,i,r){for(var e=[],o=i>=n?1:-1,s=r>=t?1:-1,f,u=n;u!==i+o;u+=o){if(u>=this._rows)break;for(f=t;f!==r+s;f+=s){if(f>=this._columns)break;e.push(this._grid[u][f])}}return e},r.prototype.Clear=function(n,t){if(!this.ValidRow(n)||!this.ValidColumn(t))return null;var i=this._grid[n][t];return this._grid[n][t]=null,this.RemoveChild(i),i},r.prototype.ClearRow=function(n){for(var i=[],t=0;t<this._columns;t++)i.push(this._grid[n][t]),this.RemoveChild(this._grid[n][t]),this._grid[n][t]=null;return i},r.prototype.ClearColumn=function(n){for(var i=[],t=0;t<this._rows;t++)i.push(this._grid[t][n]),this.RemoveChild(this._grid[t][n]),this._grid[t][n]=null;return i},r.prototype.ClearSpace=function(n,t,i,r){for(var e=[],o=i>=n?1:-1,s=r>=t?1:-1,f,u=n;u!==i+o;u+=o){if(u>this._rows)break;for(f=t;f!==r+s;f+=s){if(f>this._columns)break;e.push(this._grid[u][f]),this.RemoveChild(this._grid[u][f]),this._grid[u][f]=null}}return e},r.prototype.Draw=function(n){if(i.prototype.StartDraw.call(this,n),n.save(),i.prototype.EndDraw.call(this,n),this._drawGridLines)for(var t=0;t<this._gridLines.length;t++)this._gridLines[t].Draw(n);n.restore()},r.prototype.GetDrawBounds=function(){var t=new n.Bounds.BoundingRectangle(this.Position,this._size);return t.Rotation=this.Rotation,t},r.prototype.ConvertToRow=function(n){return Math.floor((n-(this.Position.Y-this._size.HalfHeight()))/this._tileSize.Height)},r.prototype.ConvertToColumn=function(n){return Math.floor((n-(this.Position.X-this._size.HalfWidth()))/this._tileSize.Width)},r.prototype.GetInsideGridPosition=function(t,i){return new n.Vector2d(i*this._tileSize.Width-this._size.HalfWidth()+this._tileSize.HalfWidth(),t*this._tileSize.Height-this._size.HalfHeight()+this._tileSize.HalfHeight())},r.prototype.ValidRow=function(n){return n>=0&&n<this._rows},r.prototype.ValidColumn=function(n){return n>=0&&n<this._columns},r}(t.Abstractions.Graphic2d);t.Grid=i})(n.Graphics||(n.Graphics={}));var t=n.Graphics}(EndGate||(EndGate={})),function(n){(function(t){var i=function(t){function i(i,r,u){t.call(this,new n.Vector2d(i,r)),this._Resources=u}return __extends(i,t),i}(n.Graphics.Abstractions.Graphic2d);t.TileMap=i})(n.Map||(n.Map={}));var t=n.Map}(EndGate||(EndGate={})),function(n){(function(t){var i=function(n){function t(t,i,r){n.call(this,0,0,t,i,r)}return __extends(t,n),t}(n.Graphics.Sprite2d);t.Tile=i})(n.Map||(n.Map={}));var t=n.Map}(EndGate||(EndGate={})),function(n){(function(t){var i=function(i){function r(t,r,u,f,e,o,s){typeof s=="undefined"&&(s=!1),i.call(this,t,r,e),this._grid=new n.Graphics.Grid(0,0,o.length,o[0].length,u,f,s),this.FillGridWith(o)}return __extends(r,i),r.ExtractTiles=function(n,t,i){for(var f=[],e=Math.floor(n.ClipSize.Width/t),o=Math.floor(n.ClipSize.Height/i),u,r=0;r<o;r++)for(u=0;u<e;u++)f.push(n.Extract(u*t,r*i,t,i));return f},r.prototype.Draw=function(n){i.prototype.StartDraw.call(this,n),this._grid.Draw(n),i.prototype.EndDraw.call(this,n)},r.prototype.GetDrawBounds=function(){var n=this._grid.GetDrawBounds();return n.Position=this.Position,n},r.prototype.FillGridWith=function(n){for(var u=[],r,i=0;i<n.length;i++)for(u[i]=[],r=0;r<n[i].length;r++)n[i][r]>=0?u[i].push(new t.Tile(this._Resources[n[i][r]],this._grid.TileSize().Width,this._grid.TileSize().Height)):u[i].push(null);this._grid.FillSpace(0,0,u)},r}(t.TileMap);t.SquareTileMap=i})(n.Map||(n.Map={}));var t=n.Map}(EndGate||(EndGate={}))