var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},SpriteSheetViewer=function(n){function t(t,i,r,u){var o=this,f,e;n.call(this,t),this._tileWidth=r,this._tileHeight=u,f=i.find("#getSpriteSheet"),e=i.find("#spriteSheetUrl"),this.SelectedSources=[],f.click(function(){o.loadSpritesheet(e.val()),f.blur(),e.blur()}),this._cameraDragController=new CameraDragController(t,this.Scene.Camera,this.Input.Keyboard,this.Input.Mouse),this._cameraZoomController=new CameraZoomController(this.Scene.Camera,this.Input.Mouse),f.click()}return __extends(t,n),t.prototype.loadSpritesheet=function(n){var t=this;this._activeSpriteSheet=new eg.Graphics.Assets.ImageSource(n),this._activeSpriteSheet.OnLoaded.Bind(function(){var r=!1,n,i;for(t._visibleGrid?t.Scene.Camera.Position=new eg.Vector2d(t.Scene.DrawArea.width/2,t.Scene.DrawArea.height/2):r=!0,t._visibleGrid=new eg.Graphics.Grid(t.Scene.DrawArea.width/2,t.Scene.DrawArea.height/2,Math.floor(t._activeSpriteSheet.ClipSize.Height/t._tileHeight),Math.floor(t._activeSpriteSheet.ClipSize.Width/t._tileWidth),t._tileWidth,t._tileHeight,!0),n=0;n<t._visibleGrid.Rows();n++)for(i=0;i<t._visibleGrid.Columns();i++)t._visibleGrid.Fill(n+1,i+1,new eg.Graphics.Sprite2d(0,0,t._activeSpriteSheet.Extract(i*t._tileWidth,n*t._tileHeight,t._tileWidth,t._tileHeight)));r&&(t._tileHighlighter=new TileHighlighter(t._visibleGrid),t._tileSelector=new TileSelector(t._visibleGrid,t.Scene,t.Scene.Camera,t._cameraDragController,t.Input.Mouse,function(n){t.SelectedSources=[];for(var i=0;i<n.length;i++)t.SelectedSources.push(t._visibleGrid.Get(n[i].Row,n[i].Column).Image);t._tileHighlighter.HighlightTiles(n)},function(n){for(var r,i=0;i<n.length;i++)r=t.SelectedSources.indexOf(t._visibleGrid.Get(n[i].Row,n[i].Column).Image),r>=0&&t.SelectedSources.splice(r,1);t._tileHighlighter.UnHighlightTiles(n)})),t.Scene.Add(t._visibleGrid)})},t}(eg.Game)